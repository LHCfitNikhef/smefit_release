

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to run the code &mdash; SMEFiT 3.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=f74d80cf" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=08bfcbec"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SMEFiT Tutorial" href="tutorial.html" />
    <link rel="prev" title="Code structure" href="code_struct.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SMEFiT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Theory:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../theory/SMEFT.html">Standard Model Effective Field Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/general.html">Fitting assumptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/NS.html">Nested Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/Analytic.html">Analytic solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/MCFit.html">The Monte Carlo replica method</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data and theory tables:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_theory/data.html">Experimental data format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_theory/theory.html">Theory tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_theory/covariance.html">Construction of the fit covariance matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_theory/rotation.html">Basis rotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_theory/projections.html">Projections</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Fitting code:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="code_struct.html">Code structure</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to run the code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#runcard-specifications">Runcard specifications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-and-output-path">Input and output path</a></li>
<li class="toctree-l3"><a class="reference internal" href="#theory-specifications">Theory specifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#minimizer-specifications">Minimizer specifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#datasets-to-consider-and-coefficients-to-fit">Datasets to consider and coefficients to fit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constrains-between-coefficients">Constrains between coefficients</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fit-in-different-basis">Fit in different basis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#adding-custom-likelihoods">Adding custom likelihoods</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-fit-with-ns">Running a fit with NS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-fit-with-mc">Running a fit with MC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solving-the-linear-problem">Solving the linear problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#single-parameter-fits">Single parameter fits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#individual-parameter-scan">Individual parameter scan</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">SMEFiT Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reports:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../report/tools.html">Report functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report/running.html">Produce a report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report/links.html">Link to reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Previous studies:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit_rw.html">SMEFiT RW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit_top.html">SMEFiT Top</a></li>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit_vbs.html">SMEFiT VBS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit20.html">SMEFiT2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit_uv.html">The automation of SMEFT-Assisted Constraints on UV-Complete Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit30.html">SMEFiT3.0</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Collaboration:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../people/people.html">People</a></li>
<li class="toctree-l1"><a class="reference internal" href="../people/people.html#former-members">Former members</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References &amp; API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/smefit/smefit.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zzz-refs.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SMEFiT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to run the code</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/fitting_code/running.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-run-the-code">
<span id="running-fit"></span><h1>How to run the code<a class="headerlink" href="#how-to-run-the-code" title="Link to this heading"></a></h1>
<p>In the following we provide detailed instructions on how to use the code in its different
running modes and on how to analyse the results.</p>
<section id="runcard-specifications">
<span id="runcard"></span><h2>Runcard specifications<a class="headerlink" href="#runcard-specifications" title="Link to this heading"></a></h2>
<p>The basic object required to run the code is a runcard.
In this section we document the different parameters which have to be specified here.
As example we will refer to the runcard to reproduce <code class="docutils literal notranslate"><span class="pre">smefit2.0</span></code>,
available from the repository <a class="reference external" href="https://github.com/LHCfitNikhef/smefit_database">smefit_database</a>
together with the files containing experimental data and the corresponding theory predictions.
After cloning the repository, run</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">python update_runcards_path.py -d /path/to/runcard/destination/ runcards/NS_GLOBAL_NLO_NHO.yaml</span>
</pre></div>
</div>
<p>This will create in <code class="docutils literal notranslate"><span class="pre">/path/to/runcard/destination/</span></code> a <code class="docutils literal notranslate"><span class="pre">smefit2.0</span></code> runcard ready to be used on the local machine of the user, pointing to the experimental data and an theory tables in the repository smefit_database.
In the folder <code class="docutils literal notranslate"><span class="pre">smefit_database/runcards</span></code> the input runcards for MC and NS fits with both linear (NHO)
and linear+quadratic corrections (HO) are available.</p>
<section id="input-and-output-path">
<h3>Input and output path<a class="headerlink" href="#input-and-output-path" title="Link to this heading"></a></h3>
<p>The path to where the experimental data and the corresponding theory tables are stored
is automatically set to those contained in <code class="docutils literal notranslate"><span class="pre">smefit_dayabase</span></code> by the script <code class="docutils literal notranslate"><span class="pre">update_runcards_path.py</span></code>.
The user can change them manually if other set of data are desired.
The folder where the results will be saved can be set using <code class="docutils literal notranslate"><span class="pre">result_path</span></code>. The file containing
the posterior of the fitted Wilson coefficient will be saved in <code class="docutils literal notranslate"><span class="pre">resulth_path/result_ID</span></code>.
If <code class="docutils literal notranslate"><span class="pre">result_ID</span></code> is not provided, it will be automatically set to the name of the runcard (and any already existing result will be overwritten).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">result_ID</span><span class="p">:</span>
<span class="nt">result_path</span><span class="p">:</span>
<span class="nt">data_path</span><span class="p">:</span>
<span class="nt">theory_path</span><span class="p">:</span>
</pre></div>
</div>
</section>
<section id="theory-specifications">
<h3>Theory specifications<a class="headerlink" href="#theory-specifications" title="Link to this heading"></a></h3>
<p>The default perturbative order of the theory prediction is set by the key <code class="docutils literal notranslate"><span class="pre">default_order</span></code>. Orders may also be specified
per datset, see <a class="reference external" href="./example.html#datasets-to-consider-and-coefficients-to-fit">here</a> for more details.
The order in the EFT expansion should be specified by setting <code class="docutils literal notranslate"><span class="pre">use_quad</span></code> to either <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> to include quadratic or only linear corrections respectively. The option <code class="docutils literal notranslate"><span class="pre">use_t0</span></code> controls the use
of the <code class="docutils literal notranslate"><span class="pre">t0</span></code> prescription and <code class="docutils literal notranslate"><span class="pre">use_theory_covmat</span></code> specifies whether or not to use the theory covariance matrix
which can be specified in the theory files.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">default_order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LO</span>
<span class="nt">use_quad</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">use_t0</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">use_theory_covmat</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">cutoff_scale</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">cutoff_scale</span></code> specifies the scale (in GeV) above which all datapoints will be excluded from the fit.</p>
</section>
<section id="minimizer-specifications">
<h3>Minimizer specifications<a class="headerlink" href="#minimizer-specifications" title="Link to this heading"></a></h3>
<p>The different parameters controlling the minimizer used in the analysis are specified here.
If <code class="docutils literal notranslate"><span class="pre">single_parameter_fits</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the Wilson coefficient specified in the run-card
will be fit one at time, setting all the others to 0. See <a class="reference external" href="./example.html#single-parameter-fits">here</a> for more details.
If <code class="docutils literal notranslate"><span class="pre">pairwise_fits</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, the minimizer carries out an automated series of pair-wise fits to all possible pairs of
Wilson coefficients that  are specified in the run-card.
Pairwise fits are supported only with |NS|.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pairwise_fits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">single_parameter_fits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">bounds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Null</span>

<span class="c1"># NS settings</span>
<span class="nt">nlive</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">400</span><span class="w"> </span><span class="c1"># number of live points used during sampling</span>
<span class="nt">lepsilon</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span><span class="w"> </span><span class="c1">#  Terminate when live point likelihoods are all the same, within Lepsilon tolerance.</span>
<span class="nt">target_evidence_unc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span><span class="w"> </span><span class="c1"># target evidence uncertanty</span>
<span class="nt">target_post_unc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.5</span><span class="w"> </span><span class="c1"># target posterior uncertanty</span>
<span class="nt">frac_remain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span><span class="w"> </span><span class="c1"># Set to a higher number (0.5) if you know the posterior is simple.</span>
<span class="nt">store_raw</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># if true, store the raw result and enable resuming the job.</span>
<span class="nt">vectorized</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># if true, ultranest samples a vector from the prior (recommended for large scale problems)</span>
<span class="nt">float64</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># double precision</span>


<span class="c1">#MC settings</span>
<span class="nt">mc_minimiser</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;cma&#39;</span><span class="w"> </span><span class="c1"># Allowed options are: &#39;cma&#39;, &#39;dual_annealing&#39;, &#39;trust-constr&#39;</span>
<span class="nt">restarts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class="w"> </span><span class="c1"># number of restarts (only for cma)</span>
<span class="nt">maxiter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100000</span><span class="w"> </span><span class="c1"># max number of iteration</span>
<span class="nt">chi2_threshold</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.0</span><span class="w"> </span><span class="c1"># post fit chi2 threshold</span>

<span class="c1">#A settings</span>
<span class="nt">n_samples</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span><span class="w"> </span><span class="c1"># number of the required samples of the posterior distribution</span>
</pre></div>
</div>
</section>
<section id="datasets-to-consider-and-coefficients-to-fit">
<h3>Datasets to consider and coefficients to fit<a class="headerlink" href="#datasets-to-consider-and-coefficients-to-fit" title="Link to this heading"></a></h3>
<p>The datasets and Wilson coefficients to be included in the analysis must be listed under <code class="docutils literal notranslate"><span class="pre">datasets</span></code>
and <code class="docutils literal notranslate"><span class="pre">coefficients</span></code> respectively. The default order for each dataset is taken from  <code class="docutils literal notranslate"><span class="pre">default_order</span></code>. However, it is
possible to specify specific orders per dataset. To do this, add the key <code class="docutils literal notranslate"><span class="pre">order</span></code> to the dataset entry as follows.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">datasets</span><span class="p">:</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ATLAS_tt_8TeV_ljets_Mtt</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ATLAS_tt_8TeV_dilep_Mtt</span>
<span class="w">    </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NLO_QCD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMS_tt_8TeV_ljets_Ytt</span>
<span class="w">    </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NLO_QCD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMS_tt2D_8TeV_dilep_MttYtt</span>
<span class="w">    </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NLO_QCD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMS_tt_13TeV_ljets_2015_Mtt</span>
<span class="w">    </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NLO_QCD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMS_tt_13TeV_dilep_2015_Mtt</span>
<span class="w">    </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NLO_QCD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMS_tt_13TeV_ljets_2016_Mtt</span>
<span class="w">    </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NLO_QCD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CMS_tt_13TeV_dilep_2016_Mtt</span>
<span class="w">    </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NLO_QCD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ATLAS_tt_13TeV_ljets_2016_Mtt</span>
<span class="w">    </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NLO_QCD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ATLAS_CMS_tt_AC_8TeV</span>
<span class="w">    </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NLO_QCD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ATLAS_tt_AC_13TeV</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>

<span class="c1"># Coefficients to fit</span>
<span class="nt">coefficients</span><span class="p">:</span>

<span class="w">  </span><span class="nt">OpQM</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&#39;min&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-10</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;max&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">10</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">O3pQ3</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&#39;min&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-2.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;max&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">2.0</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">Opt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&#39;min&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-25.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;max&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">15.0</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">OtW</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&#39;min&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-1.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;max&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>As exemplified above, the syntax to specify the Wilson coefficient corresponding to the operator
<code class="docutils literal notranslate"><span class="pre">O1</span></code> is <code class="docutils literal notranslate"><span class="pre">O1</span> <span class="pre">:</span> <span class="pre">{'min':</span> <span class="pre">,</span> <span class="pre">'max':}</span> </code> where <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> indicate the bounds within
the sampling is performed.</p>
</section>
<section id="constrains-between-coefficients">
<h3>Constrains between coefficients<a class="headerlink" href="#constrains-between-coefficients" title="Link to this heading"></a></h3>
<p>Some Wilson coefficients are not directly fit, but rather constrained to be linear combinations
of the other ones. Taking as example some coefficient of the Higgs sector considered in <code class="docutils literal notranslate"><span class="pre">smefit2.0</span></code>,
this can be specified in the runcard in the following way</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">OpWB</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&#39;min&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-0.3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;max&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">0.5</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">OpD</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&#39;min&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-1.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;max&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">OpqMi</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&#39;constrain&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[{</span><span class="s">&#39;OpD&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">0.9248</span><span class="p p-Indicator">},{</span><span class="s">&#39;OpWB&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">1.8347</span><span class="p p-Indicator">}],</span><span class="w"> </span><span class="s">&#39;min&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-30</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;max&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">30</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="nt">O3pq</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="s">&#39;constrain&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[{</span><span class="s">&#39;OpD&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-0.8415</span><span class="p p-Indicator">},{</span><span class="s">&#39;OpWB&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-1.8347</span><span class="p p-Indicator">}],</span><span class="w"> </span><span class="s">&#39;min&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">-0.5</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;max&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>In this example the coefficients <code class="docutils literal notranslate"><span class="pre">CpqMi</span></code> and <code class="docutils literal notranslate"><span class="pre">C3pq</span></code> correspondong to the operators
<code class="docutils literal notranslate"><span class="pre">OpqMi</span></code> and <code class="docutils literal notranslate"><span class="pre">O3pq</span></code> will be set to</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">CpqMi = 0.9248*CpD + 1.8347*CpWB</span>
<span class="l l-Scalar l-Scalar-Plain">C3pq = -0.8415*CpD -1.8347*CpWB</span>
</pre></div>
</div>
</section>
<section id="fit-in-different-basis">
<h3>Fit in different basis<a class="headerlink" href="#fit-in-different-basis" title="Link to this heading"></a></h3>
<p>It is possible to run a fit using a different basis.
In this case the coefficients specified in the runcard should be the ones to fit, and
a rotation basis defining the new basis in terms of the Warsaw basis should be given as input. This can be done
using the option below.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">rot_to_fit_basis</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/rotation/rotation.json</span>
</pre></div>
</div>
<p>In addition, it is possible to perform a fit in a PCA rotated basis. This corresponds to the basis spanned
by the eigenvectors of the Fisher information matrix at the linear level in the EFT expansion. To carry out such a fit,
add the following flag</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>smefit<span class="w"> </span>NS<span class="w"> </span>--rotate_to_pca<span class="w"> </span>path/to/the/runcard/runcard.yaml
</pre></div>
</div>
</section>
<section id="adding-custom-likelihoods">
<span id="ns"></span><h3>Adding custom likelihoods<a class="headerlink" href="#adding-custom-likelihoods" title="Link to this heading"></a></h3>
<p>SMEFiT supports the addition of customised likelihoods. This can be relevant when an external likelihood is already at hand
and one would like to combine it with the one constructed internally in SMEFiT. To make use of this feature, one should add
the following to the runcard:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">external_chi2</span><span class="p">:</span>
<span class="w">  </span><span class="s">&#39;ExternalChi2&#39;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/external/chi2.py</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">ExternalChi2</span></code> is the name of the class that must be defined in the referenced python file as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExternalChi2</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coefficients</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor that allows one to set attributes that can be called in the compute_chi2 method</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coefficients:  smefit.coefficients.CoefficientManager</span>
<span class="sd">            attributes: name, value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">example_attribute</span> <span class="o">=</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_chi2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coefficient_values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">         coefficients_values : numpy.ndarray</span>
<span class="sd">            |EFT| coefficients values</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># example</span>
        <span class="n">chi2_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">coefficient_values</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chi2_value</span>
</pre></div>
</div>
<p>One is free to set custom attributes in the constructor. The coefficient values during optimisation
are accesible via <code class="docutils literal notranslate"><span class="pre">coefficient_values</span></code> in the <code class="docutils literal notranslate"><span class="pre">compute_chi2</span></code> method. In order for the external chi2
to work, it is important one does not change the name of the <code class="docutils literal notranslate"><span class="pre">compute_chi2</span></code> method!</p>
</section>
</section>
<section id="running-a-fit-with-ns">
<h2>Running a fit with NS<a class="headerlink" href="#running-a-fit-with-ns" title="Link to this heading"></a></h2>
<p>To run a fiy using Nested Sampling use the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>smefit<span class="w"> </span>NS<span class="w"> </span>path/to/the/runcard/runcard.yaml
</pre></div>
</div>
<p>This will generate a file named <code class="docutils literal notranslate"><span class="pre">posterior.json</span></code> in the result folder,
containing the posterior distribution of the coefficients specified in the runcard.</p>
</section>
<section id="running-a-fit-with-mc">
<span id="mc"></span><h2>Running a fit with MC<a class="headerlink" href="#running-a-fit-with-mc" title="Link to this heading"></a></h2>
<p><strong>Disclaimer</strong>: the MC mode is only supported for linear fits.</p>
<p>The basic command to run a fit using Monte Carlo is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>smefit<span class="w"> </span>MC<span class="w"> </span>path/to/the/runcard/runcard.yaml<span class="w"> </span>-n<span class="w"> </span>replica_number
</pre></div>
</div>
<p>This will produce a file called <code class="docutils literal notranslate"><span class="pre">replica_&lt;replica_number&gt;/coefficients_rep_&lt;replica_number&gt;.json</span></code>
in the result folder, containing the values of the Wilson coefficients for the replica.
Once an high enough number of replicas have been produced, the results can be merged into the final posterior
running PostFit</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>smefit<span class="w"> </span>POSTFIT<span class="w"> </span>path/to/the/result/<span class="w"> </span>-n<span class="w"> </span>number_of_replicas
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;number_of_replicas&gt;</span></code> specifies the number of replicas to be used to build the posterior.
Replicas not satisfying the PostFit criteria will be discarded. If the final number of good replicas is lower than
<code class="docutils literal notranslate"><span class="pre">&lt;number_of_replicas&gt;</span></code> the code will output an error message asking to produce more replicas first.
The final output is the file <code class="docutils literal notranslate"><span class="pre">posterior.json</span></code> containing the full posterior of the Wilson coefficients.</p>
</section>
<section id="solving-the-linear-problem">
<h2>Solving the linear problem<a class="headerlink" href="#solving-the-linear-problem" title="Link to this heading"></a></h2>
<p>In case only linear cocrrections are used, one
can find the analytic solution to the linear problem by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>smefit<span class="w"> </span>A<span class="w"> </span>path/to/the/runcard/runcard.yaml
</pre></div>
</div>
<p>This will also sample the posterior distribution according to the runcard.</p>
</section>
<section id="single-parameter-fits">
<h2>Single parameter fits<a class="headerlink" href="#single-parameter-fits" title="Link to this heading"></a></h2>
<p>Given a runcard with a number of Wilson coefficients specified, it is possible to fit each of them in turn,
keeping all the other ones fix to 0.
To do this add to the runcard</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">single_parameter_fits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>and proceed as documented above for a normal fit.
For both NS, MC and A the final output will be the file <code class="docutils literal notranslate"><span class="pre">posterior.json</span></code>
containing the independent posterior of the fitted Wilson coefficients, obtained by a series os independent single parameter fits.</p>
</section>
<section id="individual-parameter-scan">
<h2>Individual parameter scan<a class="headerlink" href="#individual-parameter-scan" title="Link to this heading"></a></h2>
<p>The code can also be used to produce 1-dimensional scans of the chi2 function.
The command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="w">    </span>smefit<span class="w"> </span>SCAN<span class="w"> </span>/path/to/the/runcard/runcard.yaml
</pre></div>
</div>
<p>will produce in the results folder a series of pdf files containing plots for
1-dimensional scans of the chi2 with respect to each parameter in the runcard.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="code_struct.html" class="btn btn-neutral float-left" title="Code structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.html" class="btn btn-neutral float-right" title="SMEFiT Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, the SMEFiT developers&#39; team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>