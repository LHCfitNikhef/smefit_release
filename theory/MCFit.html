<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Monte Carlo replica method &mdash; SMEFiT 0.1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=01f34227"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Experimental data format" href="../data_theory/data.html" />
    <link rel="prev" title="Nested Sampling" href="NS.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SMEFiT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Theory:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="SMEFT.html">Standard Model Effective Field Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="general.html">Fitting assumptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="NS.html">Nested Sampling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The Monte Carlo replica method</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#formalism">Formalism</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimisation">Optimisation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#postfit-selection-criteria">Postfit selection criteria</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data and theory tables:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data_theory/data.html">Experimental data format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_theory/theory.html">Theory tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_theory/covariance.html">Construction of the fit covariance matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_theory/rotation.html">Basis rotation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Fitting code:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../fitting_code/code_struct.html">Code structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fitting_code/running.html">How to run the code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reports:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../report/tools.html">Report functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report/running.html">Produce a report</a></li>
<li class="toctree-l1"><a class="reference internal" href="../report/links.html">Link to reports</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Previous studies:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit_rw.html">SMEFiT RW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit_top.html">SMEFiT Top</a></li>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit_vbs.html">SMEFiT VBS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit20.html">SMEFiT2.0</a></li>
<li class="toctree-l1"><a class="reference internal" href="../previous_releases/smefit_uv.html">The automation of SMEFT-Assisted Constraints on UV-Complete Models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Collaboration:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../people/people.html">People</a></li>
<li class="toctree-l1"><a class="reference internal" href="../people/people.html#former-members">Former members</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References &amp; API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/smefit/smefit.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../zzz-refs.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SMEFiT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">The Monte Carlo replica method</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/theory/MCFit.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-monte-carlo-replica-method">
<h1>The Monte Carlo replica method<a class="headerlink" href="#the-monte-carlo-replica-method" title="Link to this heading"></a></h1>
<section id="formalism">
<h2>Formalism<a class="headerlink" href="#formalism" title="Link to this heading"></a></h2>
<p>The Monte Carlo replica approach (MCfit), which in turn was inspired by the
NNPDF analysis of the quark and gluon substructure of protons.</p>
<p>This method aims to construct a sampling of the probability
distribution in the space of the experimental data, which then translates
into a sampling of the probability distribution in the space of the EFT
coefficients through an optimisation procedure where the best-fit values
of the coefficients for each replica, <span class="math notranslate nohighlight">\(\boldsymbol{c}^{(k)}\)</span>, are determined.</p>
<p>Given an experimental measurement of a hard-scattering cross-section, denoted by <span class="math notranslate nohighlight">\(\sigma_i^{\rm (exp)}\)</span>,
with total uncorrelated uncertainty <span class="math notranslate nohighlight">\(\delta_{i}^{\rm (stat)}\)</span> and <span class="math notranslate nohighlight">\(n_{\rm sys}\)</span>
correlated systematic uncertainties <span class="math notranslate nohighlight">\(\delta^{\rm (sys)}_{i,\alpha}\)</span>, the <span class="math notranslate nohighlight">\(N_{\rm rep}\)</span> artificial
Monte Carlo (MC) replicas of the experimental data are generated as</p>
<div class="math notranslate nohighlight">
\[\sigma_{i}^{(\mathrm{art})(k)} = \sigma_{i}^{\rm (exp)}\left( 1 + r_{i}^{(k)}\delta_{i}^{\rm (stat)} +
\sum_{\alpha=1}^{n_{\rm sys}}r_{i,\alpha}^{(k)}\delta^{\rm (sys)}_{i,\alpha}\right)
\quad k=1,\ldots,N_{rep}\]</div>
<p>where the index <span class="math notranslate nohighlight">\(i\)</span> runs from 1 to <span class="math notranslate nohighlight">\(n_{\rm dat}\)</span> and <span class="math notranslate nohighlight">\(r_{i}^{(k)}\)</span>, <span class="math notranslate nohighlight">\(r_{i,\alpha}^{(k)}\)</span>
are univariate Gaussian random numbers.
Correlations between data points induced by systematic uncertainties
are accounted for by ensuring that <span class="math notranslate nohighlight">\(r^{(k)}_{i,\alpha}=r^{(k)}_{i',\alpha}\)</span>.</p>
<p>It can be show that central values, variances, and covariances evaluated
by averaging over the MC replicas reproduce the corresponding experimental values.</p>
<p>A fit to the <span class="math notranslate nohighlight">\(n_{\rm op}\)</span> degrees of freedom <span class="math notranslate nohighlight">\(\boldsymbol{c}/\Lambda\)</span>
is then performed for each of the MC replicas <span class="math notranslate nohighlight">\(\sigma_{i}^{(\mathrm{art})(k)}\)</span> generated.</p>
<p>The best-fit values are determined from the minimisation of the cost function</p>
<div class="math notranslate nohighlight">
\[E^{(k)}({\boldsymbol c})\equiv \frac{1}{n_{\rm dat}}\sum_{i,j=1}^{n_{\rm dat}}\left(
\sigma^{(\rm th)}_i\left( {\boldsymbol c}^{(k)}\right ) -\sigma^{{(\rm art)}(k)}_i\right ) ({\rm cov}^{-1})_{ij}
\left ( \sigma^{(\rm th)}_j\left ( {\boldsymbol c}^{(k)} \right )-\sigma^{{(\rm art)}(k)}_j\right )\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma^{(\rm th)}_i( {\boldsymbol c}^{(k)} )\)</span> indicates the theoretical
prediction for the <cite>i</cite>-th cross-section evaluated with the <cite>k</cite>-th set of EFT coefficients.</p>
<p>This process results in a collection of <span class="math notranslate nohighlight">\({\boldsymbol c}^{(k)}\)</span> best-fit
coefficient values from which estimators such as expectation values, variances,
and correlations are evaluated.</p>
<p>The overall fit quality is then evaluated using the <span class="math notranslate nohighlight">\(\chi^2\)</span> definition,
where the central experimental values are compared to the mean theoretical
prediction computed by the resulting fit replicas.</p>
<p>Various theoretical uncertainties are also included in the <span class="math notranslate nohighlight">\(\chi^2\)</span> definition for some datasets.
A consistent treatment of theoretical uncertainties in the fitting procedure means
that these are not only included in the fit via
the covariance matrix in <span class="math notranslate nohighlight">\(\chi^2\)</span> definition, but also in the corresponding replica generation.
In other words, the replicas are sampled according to a multi-Gaussian distribution
defined by the total covariance matrix which receives contributions both of experimental and of theoretical origin.
We therefore account for such errors in the generation of Monte Carlo replicas <span class="math notranslate nohighlight">\(\sigma_{i}^{(\mathrm{art})(k)}\)</span>,
<span id="id1">[<a class="reference internal" href="../zzz-refs.html#id28" title="The NNPDF Collaboration, Rabah Abdul Khalek, Richard D. Ball, Stefano Carrazza, Stefano Forte, Tommaso Giani, Zahari Kassabov, Rosalyn L. Pearson, Emanuele R. Nocera, Juan Rojo, Luca Rottoli, Maria Ubiali, Cameron Voisey, and Michael Wilson. Parton distributions with theory uncertainties: general formalism and first phenomenological studies. 2019. arXiv:1906.10698.">CKB+19</a>]</span>.</p>
<p>There are numerous advantages of using the MCfit method for global EFT analyses:</p>
<blockquote>
<div><ul class="simple">
<li><p>it does not require specific assumptions about the underlying probability distribution
of the fit parameters, and in particular does not rely on the Gaussian approximation.</p></li>
<li><p>the computational cost scales in a much milder way with the number of operators
<span class="math notranslate nohighlight">\(n_{\rm op}\)</span> included in the fit as compared to NS.</p></li>
<li><p>Thirdly, it can be used to assess the impact of new datasets in the fit <cite>a posteriori</cite>
with the Bayesian reweighting formalism.</p></li>
</ul>
</div></blockquote>
</section>
<section id="optimisation">
<h2>Optimisation<a class="headerlink" href="#optimisation" title="Link to this heading"></a></h2>
<p>In the top quark sector analysis of <span id="id2">[<a class="reference internal" href="../zzz-refs.html#id26" title="Nathan P. Hartland, Fabio Maltoni, Emanuele R. Nocera, Juan Rojo, Emma Slade, Eleni Vryonidou, and Cen Zhang. A Monte Carlo global analysis of the Standard Model Effective Field Theory: the top quark sector. JHEP, 04:100, 2019. arXiv:1901.05965, doi:10.1007/JHEP04(2019)100.">HMN+19</a>]</span>, the minimisation of
Eq.~eqref{eq:chi2definition} was achieved by a gradient descent method which relies
on local variations of the error function.
This choice is advantageous since <span class="math notranslate nohighlight">\(E^{(k)}\)</span> is at most a quartic form
of the fit parameters, and therefore evaluating its gradient is computationally efficient.</p>
<p>In the current version of the code ( see <span id="id3">[<a class="reference internal" href="../zzz-refs.html#id29" title="Jacob J. Ethier, Giacomo Magni, Fabio Maltoni, Luca Mantani, Emanuele R. Nocera, Juan Rojo, Emma Slade, Eleni Vryonidou, and Cen Zhang. Combined smeft interpretation of higgs, diboson, and top quark data from the lhc. 2021. arXiv:2105.00006.">EMM+21</a>]</span> analysis) we allow for a more complex parameter space,
using as optimiser a trust-region algorithm <code class="docutils literal notranslate"><span class="pre">trust-constr</span></code> available in the <code class="docutils literal notranslate"><span class="pre">SciPy</span></code> package.
An advantage of this method is that it allows one to provide the optimiser with any combination of constraints on the
coefficients, including existing bounds.
This is a rather useful feature, since in many cases of interest one would like to restrict
the EFT parameter space based on theoretical considerations, such as when
accounting for the LEP EWPOs or in the top-philic scenario.</p>
</section>
<section id="postfit-selection-criteria">
<h2>Postfit selection criteria<a class="headerlink" href="#postfit-selection-criteria" title="Link to this heading"></a></h2>
<p>One disadvantage of optimisation strategies such as MCfit is that as the parameter space
space is increased, the minimiser might sometimes converge on a local,
rather than on the global, minimum.
This is specially problematic in the quadratic EFT fits which often display
quasi-degenerate minima.
For this reason, it is important to implement post-fit quality selection criteria
that indicate when a fitted replica should be kept and when it should be discarded.
Here, a MC replica is kept if the total error function of the replica dataset, <span class="math notranslate nohighlight">\(E_{\rm tot}^{(k)}\)</span>,
satisfies</p>
<div class="math notranslate nohighlight">
\[E_{\rm tot}^{(k)}\le 3\]</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="NS.html" class="btn btn-neutral float-left" title="Nested Sampling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../data_theory/data.html" class="btn btn-neutral float-right" title="Experimental data format" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, the SMEFiT developers&#39; team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>